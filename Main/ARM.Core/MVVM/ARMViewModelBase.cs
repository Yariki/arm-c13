///////////////////////////////////////////////////////////
//  ARMViewModelBase.cs
//  Implementation of the Class ARMViewModelBase
//  Generated by Enterprise Architect
//  Created on:      30-Mar-2014 6:35:57 PM
///////////////////////////////////////////////////////////

using System;
using System.ComponentModel;
using System.Linq.Expressions;
using System.Runtime.Remoting.Messaging;
using System.Threading;
using System.Windows.Threading;
using ARM.Core.Interfaces;

namespace ARM.Core.MVVM
{
    public abstract class ARMViewModelBase : IARMViewModel
    {

        protected bool Disposed = false;

        ///
        /// <param name="view"></param>
        protected ARMViewModelBase(IARMView view)
        {
            View = view;
            SetDataContext();
        }

        private void SetDataContext()
        {
            Dispatcher.CurrentDispatcher.BeginInvoke(new Action(() => this.View.DataContext = this));
        }

        public event PropertyChangedEventHandler PropertyChanged;

        ///
        /// <param name="propertyName"></param>
        protected void OnPropertyChanged(string propertyName)
        {
            var temp = PropertyChanged;
            if (temp != null)
            {
                temp(this, new PropertyChangedEventArgs(propertyName));
            }
        }

        ///
        /// <param name="exp"></param>
        protected void OnPropertyChanged<T>(Expression<Func<T>> exp)
        {
            MemberExpression memberExpression = exp.Body as MemberExpression;
            if (memberExpression == null)
                throw new ArgumentException("Expression is empty");
            OnPropertyChanged(memberExpression.Member.Name);
        }

        protected string GetPropertyName<T>(Expression<Func<T>> exp)
        {
            var memExpression = exp.Body as MemberExpression;
            if (memExpression == null)
                return string.Empty;
            return memExpression.Member.Name;
        }

        protected virtual void Dispose(bool disposing)
        {
            Disposed = true;
        }

        public IARMView View
        {
            get;
            protected set;
        }

        public void Dispose()
        {
            Dispose(true);
            GC.SuppressFinalize(this);
        }
    }//end ARMViewModelBase
}//end namespace MVVM